<div class="sep-recent-orders bg-white patient_tab" style="border-radius: 15px;">
  <!-- <h2 class="text-center" style="font-family: Agbalumo; font-size: 29px; padding-top: 20px;">Hồ sơ bệnh nhân</h2> -->

  <div class="content-wrapper">
    <div class="row">
      <div class="card-box">
        <ul class="nav nav-tabs">
          <li class="nav-item mr-2"><a class="nav-link" style="padding: 10px; color: #000; cursor: pointer;"
              (click)="navigateHref('/benhnhan/danhsach/tab/hosobenhnhan/')">Thông tin
              chung</a>
          </li>
          <ng-container
            *ngIf="roleId.includes('1') || roleId.includes('2') || roleId.includes('4') || roleId.includes('5')">
            <li class="nav-item mr-2"><a class="nav-link active"
                (click)="navigateHref('/benhnhan/danhsach/tab/lichtrinhdieutri/')"
                style="padding: 10px; color: #664FC3; cursor: pointer;">Khám và điều trị</a></li>
            <li class="nav-item mr-2"><a class="nav-link" style="padding: 10px; color: #000; cursor: pointer;"
                (click)="navigateHref('/benhnhan/danhsach/tab/mauvat/')">Mẫu</a>
            </li>
            <li class="nav-item mr-2"><a class="nav-link" style="padding: 10px; color: #000; cursor: pointer;"
                (click)="navigateHref('/benhnhan/danhsach/tab/lichhen/')">Lịch hẹn</a>
            </li>
          </ng-container>
          <li class="nav-item mr-2"><a class="nav-link" style="padding: 10px; color: #000; cursor: pointer;"
              (click)="navigateHref('/benhnhan/danhsach/tab/thanhtoan/')">Thanh toán</a>
          </li>
          <li class="nav-item mr-2"><a class="nav-link" style="padding: 10px; color: #000; cursor: pointer;"
                                       (click)="navigateHref('/benhnhan/danhsach/tab/phieu-thu/')">Phiếu thu</a>
          </li>
        </ul>
      </div>
    </div>
    <div class="tab-pane show active" id="TTCtab">
      <div class="title-patientName">
        <div>
          <b>Bệnh nhân: {{patientName}}</b>
        </div>
      </div>
      <div class="row" style="padding: 0px 80px 50px;">
        <div class="col-12 mt-4">
          <button class="btn button-timekeeping" data-bs-toggle="modal" data-bs-target="#AddTreatmentModal"> <i
              class="bi bi-plus-circle-fill"></i> Ngày khám</button>
        </div>
      </div>
      <div class="row" style="padding: 0px 80px 50px;">
        <div class="col-md-12" id="accordion">
          <ng-container *ngIf="ITreatmentCourse.length > 0; else noTreatmentCourse">
            <div class="card" *ngFor="let course of ITreatmentCourse; let i = index">
              <div class="card-header" (click)="toggleCollapse(course.treatment_course_id);">
                <div class="row">
                  <div class="col">
                    <a title="Xem thông tin lần khám của đợt khám {{ course.name }}" style=" color: white;cursor: pointer; text-decoration: none; font-size: 15px;">
                      <b style="color: white;">Ngày khám: {{course.created_date | date: 'dd/MM/yyyy'}} - Chẩn đoán: {{course.provisional_diagnosis}} - Điều trị: {{ course.name }} </b>
                    </a>
                  </div>
                  <div class="col">
                    <i class="bi bi-trash3 float-end"
                      style="padding-right: 20px; padding-top: 10px; font-size: 20px; cursor: pointer;"
                      (click)="deleteTreatmentCourse(course.treatment_course_id)" title="Xóa Liệu trình"></i>
                    <i class="bi bi-pencil-square float-end"
                      style="padding-right: 20px; padding-top: 10px; font-size: 20px; cursor: pointer;"
                      data-bs-toggle="modal" data-bs-target="#EditTreatmentModal"
                      (click)="editTreatmentCourse(course);$event.stopPropagation();" title="Sửa liệu trình"></i>
<!--                    <i class="bi bi-patch-plus float-end"-->
<!--                      style="padding-right: 20px; padding-top: 10px; font-size: 20px; cursor: pointer;"-->
<!--                      (click)="navigateAddExamination(course.treatment_course_id)" title="Thêm lần khám">-->
<!--                    </i>-->
                  </div>
                </div>
              </div>
              <div *ngFor="let courseDetail of examinations; let i2 = index">
                <ng-container *ngIf="courseDetail.treatment_course_id === course.treatment_course_id">
                  <div class="card-body" *ngIf="toggleStates[course.treatment_course_id]">

                    <div class="row">
                      <div class="col">
                        <p style="cursor: pointer;" (click)="navigateEditExamination(courseDetail)"
                          title="Xem chi tiết lần khám">Lần khám {{
                          i2 + 1}}: <b>{{ courseDetail.created_date | date: 'dd/MM/yyyy'}}</b></p>
                      </div>
                      <div class="col">
                        <div class="action float-end" style="font-size: 20px; padding-right: 10px;">
                          <i class="bi bi-trash3 float-end" style="cursor: pointer;"
                            style="font-size: 20px; cursor: pointer; padding-right: 17px;" title="Xóa lần khám"
                            (click)="deleteExamination(courseDetail.examination_id)"></i>
                          <i class="bi bi-pencil-square float-end" title="Sửa lần khám"
                            style="padding-left: 25px; padding-right: 19px; font-size: 20px; cursor: pointer;color:#000"
                            (click)="navigateEditExamination(courseDetail)" data-bs-target="#EditTreatmentModal"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </ng-container>
          <ng-template #noData>
            <div class="card-body" style="padding: 10px; background-color: rgb(233, 197, 199); border-bottom: 27px;">
              <div class="row">
                <div class="col">
                  <p><b>Không có lần khám nào được tìm thấy</b></p>
                </div>
              </div>
            </div>
          </ng-template>

        </div>


      </div>
      <ng-template #noTreatmentCourse>
        <p class="no-appointment-message text-center">Bệnh nhân hiện chưa có liệu trình nào.</p>
      </ng-template>
      <div class="row" style="padding: 0px 80px 50px">
        <div class="examination-body-middle-title mb-2">
          <label> X-Quang </label>
        </div>
        <div class="button-add-img">
          <div class="btn-add-procedure">
            <button class="btn button-add" (click)="toggleAddImage()"><i
              class="bi bi-plus-circle"></i>Thêm
              mới ảnh</button>
          </div>
        </div>
        <ng-container *ngFor="let record of recordsImage; let i = index">
          <div class="col-md-3 custom-input-container">
            <div style="position: relative">
              <label for="diagnosis">Hình ảnh:</label>
              <img [src]="record.imageInsert" (click)="zoomImage()" alt="Hình ảnh mặc định" style="height: 50%; border: 1px solid black;border-radius: 10px;cursor: pointer">
              <div *ngIf="showZoomedInImage" class="modal-image"  (click)="closeZoom()">
                <img [src]="record.imageInsert" alt="Zoomed In Image" class="zoomed-in-image">
              </div>
              <div class="delete-button-container">
                <button class="delete-button" (click)="deleteRecordImage(i)">
                  x
                </button>
              </div>
            </div>
            <div class="image-button">
              <div>
                <button class="btn-image" data-bs-toggle="modal" data-bs-target="#exampleModal"
                        (click)="onChangeIndex(record.id)">Chọn hình ảnh</button>
              </div>
            </div>
          </div>
          <div class="col-md-9 custom-input-container-image">
            <label for="image">Ghi chú ảnh X-Quang:</label>
            <textarea style="border-radius: 10px" id="image" rows="3" [(ngModel)]="record.description"></textarea>
          </div>
          <div class="save-img" *ngIf="isAddImage">
<!--            <div class="save">-->
<!--              <button class="btn button-add" *ngIf="isAddImage" (click)="toggleAddImage()"-->
<!--                      style="margin-right: 3px"><i class="bi bi-check-circle"> Lưu ảnh</i></button>-->
<!--            </div>-->
<!--            <div class="cancel">-->
<!--              <button type="button" class="btn btn-cancel" (click)="deleteRecordImage(i)">Hủy</button>-->
<!--            </div>-->
          </div>
        </ng-container>
        <button class="btn button-add" (click)="onPostXRayImage()"><i
          class="bi bi-plus-circle"></i>Lưu ảnh</button>
      </div>
      <div class="bottom-left"  style="padding: 0px 80px 50px">
        <button class=" btn btn-secondary ml-2 mt-3" routerLink="/benhnhan/danhsach">Quay lại</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="submissionModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="submissionModalLabel">Chọn ảnh</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="submission-files" class="form-label">Chọn file</label>
          <input class="form-control" type="file" (change)="onFileSelected($event)" accept="image/*" #fileInput multiple
                 id="submission-files">
        </div>
        <div class="mb-3">
          <label for="link-submission" class="form-label" [(ngModel)]="imageLink">Link</label>
          <input type="text" class="form-control" id="link-submission" (change)="inputImageUrlInsert($event)" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" (click)="addImageUrl()">Hoàn
          thành</button>
      </div>
    </div>
  </div>
</div>

<app-popup-add-treatmentcourse></app-popup-add-treatmentcourse>
<app-popup-edit-treatmentcourse [TreatmentCourse]="TreatmentCourse"></app-popup-edit-treatmentcourse>
