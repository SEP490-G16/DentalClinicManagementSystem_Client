<div class="sep-recent-orders">
  <!-- <section class="table__header">
    <div class="export__file">
    </div>
  </section> -->

  <div class="row mt-4 mb-4">
    <div class="col-4">
      <button class="btn button-timekeeping" style="margin-right: 30px;" data-bs-toggle="modal" data-bs-target="#myModal"
        (click)="openAddAppointmentModal()"><i class="bi bi-plus-circle"></i>
        Thêm
        lịch hẹn bệnh nhân cũ</button>

      <button class="btn button-timekeeping" data-bs-toggle="modal" data-bs-target="#myNewModal"
        (click)="openAddAppointmentModal()"><i class="bi bi-plus-circle"></i>
        Thêm
        lịch hẹn bệnh nhân mới</button>
    </div>
    <div class="col-4">
      <form class="row row-cols-sm-auto">
        <div class="input-group">
          <input class="form-control" placeholder="DD/MM/YYYY" name="dp" [(ngModel)]="startDateNgb" ngbDatepicker
            #d="ngbDatepicker" (ngModelChange)="getAppointmentList()" />
          <button class="btn btn-outline-secondary bi bi-calendar3" (click)="d.toggle()" type="button"></button>
        </div>
      </form>
    </div>

    <div class="col-4">
      <select class="form-select input-custom float-end" aria-label="Default select example"
        [(ngModel)]="selectedProcedure" (change)="filterAppointments()">
        <option selected value="">Tất cả loại điều trị</option>
        <option *ngFor="let a of listGroupService" value={{a.medical_procedure_group_id}}>{{a.name}}</option>
      </select>
    </div>
  </div>

  <div class="table-container">
    <table>
      <thead class="sticky-thead">
        <tr>
          <th>Mã bệnh nhân</th>
          <th>Tên bệnh nhân</th>
          <th>Khách hàng mới</th>
          <th>SĐT</th>
          <th>Loại điều trị</th>
          <th>Bác sĩ</th>
          <th>Thời gian hẹn khám</th>
          <th>Thao tác</th>
          <th>Chuyển hướng</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let a of filteredAppointments">
          <ng-container *ngFor="let ap of a.appointments">
            <tr class="hover-patient" title="Xem thông tin bệnh nhân {{detail.patient_name}}"
              *ngFor="let detail of ap.details" (click)="details(detail.patient_id)">
              <ng-container *ngIf="detail.migrated == 'false'">
                <td class="patient-id">
                  {{detail.patient_id}}
                </td>
                <td class="patient-name">
                  {{detail.patient_name}}
                </td>
                <td>{{detail.patient_created_date == 1 ? "Bệnh nhân đến lần đầu tiên" : detail.patient_created_date
                  == 2 ? "Bệnh nhân tái khám" : "Dữ liệu trước"}}</td>
                <td class="patient-phone">
                  {{normalizePhoneNumber(detail.phone_number)}}
                </td>
                <td class="patient-pn">
                  {{detail.procedure_name}}
                </td>
                <td class="patient-doctorname">{{ detail.doctor }}</td>
                <td class="appointments-time">{{timestampToTime(detail.time)}} - {{timestampToDate(a.date) | date:
                  'dd-MM-yyyy'}}</td>
                <td class="table_button">
                  <button class="btn btn-primary p-1 m-r-3" style="padding: 2px 3px; margin-right: 3px"
                    title="Sửa lịch hẹn" data-bs-toggle="modal" data-bs-target="#editAppointmentModal"
                    (click)="openEditModal(detail, a.date, $event)">
                    <i class="bi bi-pencil-square"></i></button>
                  <button class="btn btn-danger p-1" style="padding: 2px 5px" title="Xoá lịch hẹn"
                    (click)="deleteAppointment(detail, a.date, $event)"> <i class="bi bi-trash"></i></button>
                </td>
                <td *ngIf="detail.status == 2 && checkDate(a.date)" class="direct-click">
                  <button class="btn btn-cus btn-redirect"
                    (click)="postExchangeAppointmentToWaitingRoom(a.date, detail ,$event)">
                    Đến phòng chờ
                  </button>
                </td>
                <td *ngIf="detail.status == 2 && !checkDate(a.date)" class="direct-click">
                  <button class="btn btn-redirect" style="width: 100px; color: red;">
                    <b>Trễ lịch hẹn</b>
                  </button>
                </td>
                <td *ngIf="detail.status == 1" class="direct-click">
                  <p style="color: green;"><b>Đã khám</b></p>
                </td>
                <td *ngIf="detail.status == 3" class="direct-click">
                  <p style="color: green;"><b>Đã đến</b></p>
                </td>
              </ng-container>
            </tr>
          </ng-container>
        </ng-container>

      </tbody>
    </table>

  </div>
</div>
<!-- End of Recent Orders -->

<!-- <app-popup-add-appointment (newItemEvent)="addItem($event)"></app-popup-add-appointment> -->
<app-popup-add-appointment [datesDisabled]="datesDisabled" (newAppointmentAdded)="onNewAppointmentAdded($event)"
  [filteredAppointments]="filteredAppointments"></app-popup-add-appointment>
<app-popup-edit-appointment [datesDisabled]="datesDisabled" [selectedAppointment]="selectedAppointment"
  [dateString]="dateString" [timeString]="timeString"
  [filteredAppointments]="filteredAppointments"></app-popup-edit-appointment>
<app-popup-add-appointment-new [datesDisabled]="datesDisabled"
  [filteredAppointments]="filteredAppointments"></app-popup-add-appointment-new>
